{#
/**
 * @file
 * Template for user dashboard page.
 *
 * Available variables:
 * - user: The user entity.
 */
#}

<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="etvcms-header">
      <h1 class="system-title">e-TVCMS</h1>
      <p class="system-subtitle">Electronic Tender and Content Management System</p>
    </div>
    
    <div class="top-navigation">
      <div class="nav-left">
        <a href="/dashboard" class="nav-item active">
          <span class="nav-icon">üè†</span> Home
        </a>
        <a href="/tenders" class="nav-item">
          <span class="nav-icon">üìã</span> Tender
        </a>
        <a href="/faq" class="nav-item">
          <span class="nav-icon">‚ùì</span> FAQ
        </a>
      </div>
      
      <div class="nav-right">
        <a href="https://wa.me/60123456789" class="contact-btn whatsapp">
          <span class="icon">üí¨</span> WhatsApp
        </a>
        <a href="mailto:support@etvcms.gov.my" class="contact-btn email">
          <span class="icon">‚úâÔ∏è</span> Email
        </a>
        
        <div class="account-menu">
          <button class="account-btn">
            <span class="icon">üë§</span> Account ‚ñº
          </button>
          <div class="account-dropdown">
            <a href="/user/profile" class="dropdown-item" data-dashboard-link="profile" onclick="return handleDashboardLink(event, '/user/profile', 'profile')">
              <span class="icon">üë§</span> My Profile
            </a>
            <a href="/user/password" class="dropdown-item">
              <span class="icon">üîë</span> Password
            </a>
            <a href="/company/details" class="dropdown-item active" data-dashboard-link="company-details" onclick="return handleDashboardLink(event, '/company/details', 'company-details')">
              <span class="icon">üè¢</span> Company Details
            </a>
            <a href="/tender/create" class="dropdown-item" data-dashboard-link="create-tender" onclick="return handleDashboardLink(event, '/tender/create', 'create-tender')">
              <span class="icon">üìã</span> Create Tender
            </a>
            <a href="/tender-management/dashboard" class="dropdown-item" data-dashboard-link="tender-management" onclick="return handleDashboardLink(event, '/tender-management/dashboard', 'tender-management')">
              <span class="icon">üéØ</span> Tender Management
            </a>
            <a href="/proposals" class="dropdown-item" data-dashboard-link="proposals" onclick="return handleDashboardLink(event, '/proposals', 'proposals')">
              <span class="icon">üìù</span> Proposal
            </a>
            <a href="/user/logout" class="dropdown-item logout">
              <span class="icon">üö™</span> Logout
            </a>
          </div>
        </div>
      </div>
    </div>
    
    
  </div>

  <!-- Main Content Area (Dynamic) -->
  <div class="dashboard-main-content">
    <!-- Content will be loaded here dynamically -->
  </div>

</div>

<script>
// Immediate JavaScript to handle navigation - no waiting for Drupal behaviors
(function() {
  console.log('Dashboard navigation script loaded');
  
  // Function to prevent default navigation and load content
  function handleDashboardLink(e, url, contentType) {
    e.preventDefault();
    e.stopPropagation();
    console.log('Intercepting navigation to:', url, contentType);
    
    // Remove active classes
    document.querySelectorAll('.dropdown-item, .nav-item, .action-btn').forEach(function(el) {
      el.classList.remove('active');
    });
    
    // Add active class to clicked element
    e.target.closest('a').classList.add('active');
    
    // Load content
    loadContent(contentType);
    
    return false;
  }
  
  // Load different content types
  function loadContent(type) {
    var contentArea = document.querySelector('.dashboard-main-content');
    if (!contentArea) return;
    
    console.log('Loading content type:', type);
    
    switch(type) {
      case 'company-details':
        contentArea.innerHTML = getCompanyDetailsForm();
        loadExistingCompanyData();
        break;
      case 'create-tender':
        contentArea.innerHTML = getCreateTenderForm();
        break;
      case 'tender-management':
        loadTenderManagementModule();
        break;
      case 'proposals':
        contentArea.innerHTML = getProposalsContent();
        break;
      case 'profile':
        contentArea.innerHTML = getProfileContent();
        break;
      default:
        contentArea.innerHTML = getDashboardHome();
    }
  }
  
  // Handle tender form submission
  window.handleTenderFormSubmit = function(e) {
    e.preventDefault();
    console.log('Tender form submitted');
    
    var form = e.target;
    var formData = new FormData(form);
    var submitBtn = form.querySelector('.btn-save');
    
    // Basic validation
    var requiredFields = ['tender_title', 'tender_type', 'tender_category', 'episode_duration', 'total_episodes', 'submission_deadline', 'production_start', 'production_end', 'budget_per_episode'];
    var missingFields = [];
    
    requiredFields.forEach(function(fieldName) {
      var field = form.querySelector('[name="' + fieldName + '"]');
      if (!field || !field.value.trim()) {
        missingFields.push(fieldName.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()));
      }
    });
    
    if (missingFields.length > 0) {
      showMessage('Please fill in all required fields: ' + missingFields.join(', '), 'error');
      return false;
    }
    
    // Show loading state
    submitBtn.disabled = true;
    submitBtn.textContent = 'Saving...';
    
    // Simulate saving (you can replace this with actual AJAX call)
    setTimeout(function() {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Tender';
      showMessage('Tender saved successfully!', 'success');
      
      // Optionally redirect to tender list
      setTimeout(function() {
        loadContent('dashboard');
      }, 2000);
    }, 1500);
    
    return false;
  };
  
  // Auto-calculate total budget
  function calculateTotalBudget() {
    var budgetPerEpisode = document.getElementById('budget_per_episode');
    var totalEpisodes = document.getElementById('total_episodes');
    var totalBudget = document.getElementById('total_budget');
    
    if (budgetPerEpisode && totalEpisodes && totalBudget) {
      var budget = parseFloat(budgetPerEpisode.value) || 0;
      var episodes = parseInt(totalEpisodes.value) || 0;
      totalBudget.value = (budget * episodes).toFixed(2);
    }
  }
  
  // Show live tenders
  window.showLiveTenders = function() {
    showMessage('Live Tender feature coming soon!', 'info');
  };
  
  // Load existing company data
  function loadExistingCompanyData() {
    console.log('Loading existing company data...');
    
    fetch('/ajax/company/get', {
      method: 'GET',
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    .then(function(response) {
      return response.json();
    })
    .then(function(result) {
      if (result.success && result.data) {
        console.log('Company data loaded:', result.data);
        populateCompanyForm(result.data);
      } else {
        console.log('No existing company data found');
      }
    })
    .catch(function(error) {
      console.error('Error loading company data:', error);
    });
  }
  
  // Populate form with existing data
  function populateCompanyForm(data) {
    var form = document.getElementById('company-details-form');
    if (!form) return;
    
    // Populate form fields
    var fields = ['company_name', 'business_registration_number', 'email', 'phone', 'address', 'postal_code', 'city', 'state'];
    fields.forEach(function(fieldName) {
      var field = form.querySelector('[name="' + fieldName + '"]');
      if (field && data[fieldName]) {
        field.value = data[fieldName];
      }
    });
    
    console.log('Form populated with existing data');
  }
  
  // Load Tender Management Module
  function loadTenderManagementModule() {
    var contentArea = document.querySelector('.dashboard-main-content');
    if (!contentArea) return;
    
    contentArea.innerHTML = `
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <p>Loading Tender Management System...</p>
      </div>
    `;
    
    // Redirect to tender management module
    window.location.href = '/tender-management/dashboard';
  }
  
  // Company details form HTML
  function getCompanyDetailsForm() {
    return `
      <div class="dashboard-content company-details-section">
        <div class="content-header">
          <h2 class="content-title">COMPANY DETAILS</h2>
          <div class="breadcrumb">
            <span>Account Menu</span> > <span class="current">Company Details</span>
          </div>
        </div>
        
        <div class="purpose-statement">
          <p>‚Ä¢ Completing Company Details is necessary to meet tender eligibility requirements</p>
        </div>
        
        <form id="company-details-form" class="company-form" onsubmit="return handleFormSubmit(event)">
          <div class="form-section">
            <h3 class="section-title">Company Information</h3>
            
            <div class="form-grid">
              <div class="form-group full-width">
                <label for="company_name">Company Name <span class="required">*</span></label>
                <input type="text" id="company_name" name="company_name" class="form-control" required>
              </div>
              
              <div class="form-group">
                <label for="business_registration_number">Business Registration Number <span class="required">*</span></label>
                <input type="text" id="business_registration_number" name="business_registration_number" class="form-control" required>
              </div>
              
              <div class="form-group">
                <label for="email">Email <span class="required">*</span></label>
                <input type="email" id="email" name="email" class="form-control" required>
              </div>
              
              <div class="form-group">
                <label for="phone">Phone Number <span class="required">*</span></label>
                <input type="tel" id="phone" name="phone" class="form-control" required>
              </div>
              
              <div class="form-group">
                <label for="postal_code">Postal Code <span class="required">*</span></label>
                <input type="text" id="postal_code" name="postal_code" class="form-control" pattern="[0-9]{5}" required>
              </div>
              
              <div class="form-group full-width">
                <label for="address">Address <span class="required">*</span></label>
                <textarea id="address" name="address" class="form-control" rows="3" required></textarea>
              </div>
              
              <div class="form-group">
                <label for="city">City <span class="required">*</span></label>
                <input type="text" id="city" name="city" class="form-control" required>
              </div>
              
              <div class="form-group">
                <label for="state">State <span class="required">*</span></label>
                <select id="state" name="state" class="form-control" required>
                  <option value="">- Select State -</option>
                  <option value="johor">Johor</option>
                  <option value="kedah">Kedah</option>
                  <option value="kelantan">Kelantan</option>
                  <option value="kuala_lumpur">Kuala Lumpur</option>
                  <option value="labuan">Labuan</option>
                  <option value="melaka">Melaka</option>
                  <option value="negeri_sembilan">Negeri Sembilan</option>
                  <option value="pahang">Pahang</option>
                  <option value="penang">Penang</option>
                  <option value="perak">Perak</option>
                  <option value="perlis">Perlis</option>
                  <option value="putrajaya">Putrajaya</option>
                  <option value="sabah">Sabah</option>
                  <option value="sarawak">Sarawak</option>
                  <option value="selangor">Selangor</option>
                  <option value="terengganu">Terengganu</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="form-section">
            <h3 class="section-title">Board of Directors</h3>
            <div class="directors-section">
              <table class="directors-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Position</th>
                    <th>IC/Passport</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="directors-tbody">
                  <tr class="empty-row">
                    <td colspan="4" class="text-center">No directors added yet.</td>
                  </tr>
                </tbody>
              </table>
              <button type="button" class="btn btn-add-director" onclick="addDirector()">Add Director</button>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-save">Save Company Details</button>
          </div>
        </form>
      </div>
    `;
  }
  
  // Dashboard home content
  function getDashboardHome() {
    return `
      <div class="dashboard-content home-section">
        
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <div class="card-icon">üè¢</div>
            <h3>Company Details</h3>
            <p>Complete your company profile to participate in tenders</p>
            <a href="/company/details" class="btn btn-primary" data-dashboard-link="company-details" onclick="return handleDashboardLink(event, '/company/details', 'company-details')">Complete Details</a>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">üìã</div>
            <h3>Active Tenders</h3>
            <p>View and apply for available tenders</p>
            <button class="btn btn-primary">View Tenders</button>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">üìù</div>
            <h3>My Proposals</h3>
            <p>Track your submitted proposals</p>
            <a href="/proposals" class="btn btn-primary" data-dashboard-link="proposals" onclick="return handleDashboardLink(event, '/proposals', 'proposals')">View Proposals</a>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">üë§</div>
            <h3>Profile Settings</h3>
            <p>Manage your account settings</p>
            <a href="/user/profile" class="btn btn-primary" data-dashboard-link="profile" onclick="return handleDashboardLink(event, '/user/profile', 'profile')">Edit Profile</a>
          </div>
        </div>
      </div>
    `;
  }
  
  // Other content functions
  function getProposalsContent() {
    return `
      <div class="dashboard-content proposals-section">
        <div class="content-header">
          <h2 class="content-title">MY PROPOSALS</h2>
          <div class="breadcrumb">
            <span>Account Menu</span> > <span class="current">Proposals</span>
          </div>
        </div>
        <div class="proposals-grid">
          <div class="proposal-card">
            <h3>Proposal Management</h3>
            <p>View and manage your submitted proposals</p>
            <button class="btn btn-primary">View Proposals</button>
          </div>
        </div>
      </div>
    `;
  }
  
  // Get Create Tender form content
  function getCreateTenderForm() {
    return `
      <div class="dashboard-content create-tender-section">
        <div class="content-header">
          <h1><span class="icon">üìã</span> Create New Tender</h1>
          <p class="subtitle">Complete all requirements for application participation</p>
        </div>
        
        <div class="tender-form-container">
          <div class="tender-form-main">
            <form id="create-tender-form" class="tender-form" onsubmit="return handleTenderFormSubmit(event)">
              
              <!-- Tender Basic Information -->
              <div class="form-section">
                <h3>Basic Tender Information</h3>
                
                <div class="form-row">
                  <div class="form-group">
                    <label for="tender_title">Tender Title <span class="required">*</span></label>
                    <input type="text" id="tender_title" name="tender_title" class="form-control" required>
                  </div>
                </div>
                
                <div class="form-row">
                  <div class="form-group col-6">
                    <label for="tender_type">Type <span class="required">*</span></label>
                    <select id="tender_type" name="tender_type" class="form-control" required>
                      <option value="">Please Select</option>
                      <option value="CONTINUATION SERIES">CONTINUATION SERIES</option>
                      <option value="NEW">NEW</option>
                      <option value="OTHERS">OTHERS</option>
                    </select>
                  </div>
                  <div class="form-group col-6">
                    <label for="tender_category">Category <span class="required">*</span></label>
                    <select id="tender_category" name="tender_category" class="form-control" required>
                      <option value="">Please Select</option>
                      <option value="DRAMA">DRAMA</option>
                      <option value="DOCUMENTARY">DOCUMENTARY</option>
                      <option value="ENTERTAINMENT">ENTERTAINMENT</option>
                      <option value="NEWS">NEWS</option>
                      <option value="SPORTS">SPORTS</option>
                    </select>
                  </div>
                </div>
                
                <div class="form-row">
                  <div class="form-group col-6">
                    <label for="episode_duration">Duration Per Episode <span class="required">*</span></label>
                    <select id="episode_duration" name="episode_duration" class="form-control" required>
                      <option value="">Please Select</option>
                      <option value="30 minutes">30 minutes</option>
                      <option value="45 minutes">45 minutes</option>
                      <option value="60 minutes">60 minutes</option>
                      <option value="90 minutes">90 minutes</option>
                      <option value="120 minutes">120 minutes</option>
                    </select>
                  </div>
                  <div class="form-group col-6">
                    <label for="total_episodes">Total Episodes <span class="required">*</span></label>
                    <input type="number" id="total_episodes" name="total_episodes" class="form-control" min="1" required>
                  </div>
                </div>
                
                <div class="form-row">
                  <div class="form-group">
                    <label for="tender_description">Tender Description <span class="required">*</span></label>
                    <textarea id="tender_description" name="tender_description" class="form-control" rows="4" required placeholder="Please enter complete description about this tender..."></textarea>
                  </div>
                </div>
              </div>
              
              <!-- Timeline -->
              <div class="form-section">
                <h3>Timeline Schedule</h3>
                
                <div class="form-row">
                  <div class="form-group col-6">
                    <label for="submission_deadline">Submission Deadline <span class="required">*</span></label>
                    <input type="datetime-local" id="submission_deadline" name="submission_deadline" class="form-control" required>
                  </div>
                  <div class="form-group col-6">
                    <label for="evaluation_period">Evaluation Period <span class="required">*</span></label>
                    <input type="text" id="evaluation_period" name="evaluation_period" class="form-control" placeholder="e.g: 2 weeks from deadline" required>
                  </div>
                </div>
                
                <div class="form-row">
                  <div class="form-group col-6">
                    <label for="production_start">Production Start <span class="required">*</span></label>
                    <input type="date" id="production_start" name="production_start" class="form-control" required>
                  </div>
                  <div class="form-group col-6">
                    <label for="production_end">Production End <span class="required">*</span></label>
                    <input type="date" id="production_end" name="production_end" class="form-control" required>
                  </div>
                </div>
              </div>
              
              <!-- Budget -->
              <div class="form-section">
                <h3>Budget Information</h3>
                
                <div class="form-row">
                  <div class="form-group col-6">
                    <label for="budget_per_episode">Budget Per Episode (RM) <span class="required">*</span></label>
                    <input type="number" id="budget_per_episode" name="budget_per_episode" class="form-control" min="0" step="0.01" required>
                  </div>
                  <div class="form-group col-6">
                    <label for="total_budget">Total Budget (RM) <span class="required">*</span></label>
                    <input type="number" id="total_budget" name="total_budget" class="form-control" min="0" step="0.01" readonly>
                  </div>
                </div>
              </div>
              
              <!-- Requirements -->
              <div class="form-section">
                <h3>Special Requirements</h3>
                
                <div class="form-row">
                  <div class="form-group">
                    <label for="technical_requirements">Technical Requirements</label>
                    <textarea id="technical_requirements" name="technical_requirements" class="form-control" rows="3" placeholder="Please specify technical requirements such as video format, audio, etc..."></textarea>
                  </div>
                </div>
                
                <div class="form-row">
                  <div class="form-group">
                    <label for="content_requirements">Content Requirements</label>
                    <textarea id="content_requirements" name="content_requirements" class="form-control" rows="3" placeholder="Please specify content requirements, theme, target audience, etc..."></textarea>
                  </div>
                </div>
              </div>
              
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="loadContent('dashboard')">Cancel</button>
                <button type="submit" class="btn btn-primary btn-save">Save Tender</button>
              </div>
            </form>
          </div>
          
          <!-- Requirements Checklist Sidebar -->
          <div class="tender-requirements-sidebar">
            <div class="requirements-card">
              <h4>üìã Eligibility Requirements for Application</h4>
              
              <div class="requirement-list">
                <div class="requirement-item completed">
                  <span class="check-icon">‚úÖ</span>
                  <span class="requirement-text">Suruhanjaya Syarikat Malaysia</span>
                </div>
                
                <div class="requirement-item completed">
                  <span class="check-icon">‚úÖ</span>
                  <span class="requirement-text">Ministry of Finance</span>
                </div>
                
                <div class="requirement-item completed">
                  <span class="check-icon">‚úÖ</span>
                  <span class="requirement-text">Company Profile</span>
                </div>
                
                <div class="requirement-item completed">
                  <span class="check-icon">‚úÖ</span>
                  <span class="requirement-text">FINAS Film Production</span>
                </div>
                
                <div class="requirement-item completed">
                  <span class="check-icon">‚úÖ</span>
                  <span class="requirement-text">FINAS Film Distribution</span>
                </div>
                
                <div class="requirement-item completed">
                  <span class="check-icon">‚úÖ</span>
                  <span class="requirement-text">KKMM Swasta</span>
                </div>
                
                <div class="requirement-item completed">
                  <span class="check-icon">‚úÖ</span>
                  <span class="requirement-text">KKMM Syndicated</span>
                </div>
                
                <div class="requirement-item completed">
                  <span class="check-icon">‚úÖ</span>
                  <span class="requirement-text">Bumiputera Status</span>
                </div>
                
                <div class="requirement-item completed">
                  <span class="check-icon">‚úÖ</span>
                  <span class="requirement-text">Company Audit</span>
                </div>
                
                <div class="requirement-item completed">
                  <span class="check-icon">‚úÖ</span>
                  <span class="requirement-text">Sijil Perakuan Penyiaran Program Film (SPP) FINAS</span>
                </div>
                
                <div class="requirement-item completed">
                  <span class="check-icon">‚úÖ</span>
                  <span class="requirement-text">Sijil MyIPO</span>
                </div>
              </div>
              
              <div class="requirement-status">
                <p class="status-text">‚úÖ Your application has been approved.</p>
                <p class="status-subtext">You can now participate in all tenders.</p>
                
                <button class="btn btn-info btn-sm" onclick="showLiveTenders()">
                  üì∫ Live Tender
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
  }
  
  function getProfileContent() {
    return `
      <div class="dashboard-content profile-section">
        <div class="content-header">
          <h2 class="content-title">MY PROFILE</h2>
          <div class="breadcrumb">
            <span>Account Menu</span> > <span class="current">My Profile</span>
          </div>
        </div>
        <div class="profile-info">
          <h3>Profile Information</h3>
          <p>Manage your personal account information</p>
          <button class="btn btn-primary">Edit Profile</button>
        </div>
      </div>
    `;
  }
  
  // Handle form submission
  window.handleFormSubmit = function(e) {
    e.preventDefault();
    console.log('Form submitted via AJAX');
    
    var form = e.target;
    var formData = new FormData(form);
    var submitBtn = form.querySelector('.btn-save');
    
    // Validate required fields
    var requiredFields = ['company_name', 'business_registration_number', 'email', 'phone', 'address', 'city', 'state'];
    var missingFields = [];
    
    requiredFields.forEach(function(fieldName) {
      var field = form.querySelector('[name="' + fieldName + '"]');
      if (!field || !field.value.trim()) {
        missingFields.push(fieldName.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()));
      }
    });
    
    if (missingFields.length > 0) {
      showMessage('Please fill in all required fields: ' + missingFields.join(', '), 'error');
      return false;
    }
    
    // Validate email
    var email = form.querySelector('[name="email"]').value;
    var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      showMessage('Please enter a valid email address.', 'error');
      return false;
    }
    
    // Validate postal code
    var postalCode = form.querySelector('[name="postal_code"]').value;
    if (postalCode && !/^\d{5}$/.test(postalCode)) {
      showMessage('Please enter a valid 5-digit postal code.', 'error');
      return false;
    }
    
    // Show loading state
    submitBtn.disabled = true;
    submitBtn.textContent = 'Saving...';
    
    // Convert FormData to regular object for JSON
    var data = {};
    for (var pair of formData.entries()) {
      data[pair[0]] = pair[1];
    }
    
    // Add directors data
    var directorsData = [];
    var directorRows = form.querySelectorAll('.director-row');
    directorRows.forEach(function(row) {
      var name = row.querySelector('[name="director_name[]"]').value;
      var position = row.querySelector('[name="director_position[]"]').value;
      var ic = row.querySelector('[name="director_ic[]"]').value;
      
      if (name && position && ic) {
        directorsData.push({
          name: name,
          position: position,
          ic: ic
        });
      }
    });
    
    if (directorsData.length > 0) {
      data.directors = JSON.stringify(directorsData);
    }
    
    // Send AJAX request
    fetch('/ajax/company/save', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-Requested-With': 'XMLHttpRequest'
      },
      body: new URLSearchParams(data)
    })
    .then(function(response) {
      return response.json();
    })
    .then(function(result) {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Company Details';
      
      if (result.success) {
        showMessage(result.message, 'success');
        console.log('Company details saved successfully');
      } else {
        showMessage(result.message || 'Failed to save company details', 'error');
        console.error('Save failed:', result.message);
      }
    })
    .catch(function(error) {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Company Details';
      showMessage('Network error. Please check your connection and try again.', 'error');
      console.error('Network error:', error);
    });
    
    return false;
  };
  
  // Show message function
  function showMessage(message, type) {
    // Remove existing messages
    var existingMessages = document.querySelectorAll('.messages');
    existingMessages.forEach(function(msg) {
      msg.parentNode.removeChild(msg);
    });
    
    // Create new message
    var messageDiv = document.createElement('div');
    messageDiv.className = 'messages messages--' + type;
    messageDiv.innerHTML = message;
    
    // Insert at the top of the content area
    var contentArea = document.querySelector('.dashboard-content');
    if (contentArea) {
      contentArea.insertBefore(messageDiv, contentArea.firstChild);
    }
    
    // Auto-remove message after 8 seconds
    setTimeout(function() {
      if (messageDiv.parentNode) {
        messageDiv.parentNode.removeChild(messageDiv);
      }
    }, 8000);
  }
  
  // Add director function
  window.addDirector = function() {
    var tbody = document.getElementById('directors-tbody');
    var emptyRow = tbody.querySelector('.empty-row');
    if (emptyRow) {
      emptyRow.parentNode.removeChild(emptyRow);
    }
    
    var newRow = document.createElement('tr');
    newRow.className = 'director-row';
    newRow.innerHTML = `
      <td><input type="text" name="director_name[]" class="form-control" placeholder="Director Name"></td>
      <td><input type="text" name="director_position[]" class="form-control" placeholder="Position"></td>
      <td><input type="text" name="director_ic[]" class="form-control" placeholder="IC/Passport"></td>
      <td><button type="button" class="btn btn-danger btn-sm" onclick="removeDirector(this)">Remove</button></td>
    `;
    tbody.appendChild(newRow);
  };
  
  // Remove director function
  window.removeDirector = function(button) {
    var row = button.closest('tr');
    row.parentNode.removeChild(row);
    
    var tbody = document.getElementById('directors-tbody');
    if (tbody.children.length === 0) {
      tbody.innerHTML = '<tr class="empty-row"><td colspan="4" class="text-center">No directors added yet.</td></tr>';
    }
  };
  
  // Make handleDashboardLink global
  window.handleDashboardLink = handleDashboardLink;
  
  // DOM ready handler
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM ready - setting up navigation');
    
    // Load dashboard home initially
    loadContent('home');
    
    // Add event listeners to all navigation links
    document.addEventListener('click', function(e) {
      var target = e.target.closest('a');
      if (!target) return;
      
      var href = target.getAttribute('href');
      var dashboardLink = target.getAttribute('data-dashboard-link');
      
      // Handle specific dashboard links
      if (dashboardLink) {
        console.log('Dashboard link detected:', dashboardLink);
        return handleDashboardLink(e, href, dashboardLink);
      }
      
      // Handle company details links
      if (href && href.includes('/company')) {
        console.log('Company link detected:', href);
        return handleDashboardLink(e, href, 'company-details');
      }
      
      // Handle proposals links
      if (href && href.includes('/proposals')) {
        console.log('Proposals link detected:', href);
        return handleDashboardLink(e, href, 'proposals');
      }
      
      // Handle profile links
      if (href && href.includes('/user/profile')) {
        console.log('Profile link detected:', href);
        return handleDashboardLink(e, href, 'profile');
      }
    });
  });
  
})();
</script>

<style>
/* Tender Form Styling */
.create-tender-section {
  background: #f8f9fa;
  min-height: 100vh;
  padding: 20px;
}

.create-tender-section .content-header {
  background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
  color: white;
  padding: 30px;
  border-radius: 10px 10px 0 0;
  margin-bottom: 0;
}

.create-tender-section .content-header h1 {
  margin: 0;
  font-size: 28px;
  font-weight: bold;
}

.create-tender-section .content-header .subtitle {
  margin: 10px 0 0 0;
  font-size: 16px;
  opacity: 0.9;
}

.tender-form-container {
  display: flex;
  gap: 30px;
  background: white;
  border-radius: 0 0 10px 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  overflow: hidden;
}

.tender-form-main {
  flex: 1;
  padding: 30px;
}

.tender-requirements-sidebar {
  width: 350px;
  background: #f8f9fa;
  border-left: 1px solid #dee2e6;
  padding: 20px;
}

.tender-form .form-section {
  margin-bottom: 30px;
  padding-bottom: 25px;
  border-bottom: 1px solid #dee2e6;
}

.tender-form .form-section:last-child {
  border-bottom: none;
}

.tender-form .form-section h3 {
  color: #1e3c72;
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid #e9ecef;
}

.tender-form .form-row {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
}

.tender-form .form-group {
  flex: 1;
}

.tender-form .form-group.col-6 {
  flex: 0 0 calc(50% - 10px);
}

.tender-form .form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: #333;
}

.tender-form .form-control {
  width: 100%;
  padding: 12px 15px;
  border: 1px solid #ced4da;
  border-radius: 5px;
  font-size: 14px;
  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.tender-form .form-control:focus {
  border-color: #2a5298;
  outline: 0;
  box-shadow: 0 0 0 0.2rem rgba(42, 82, 152, 0.25);
}

.tender-form textarea.form-control {
  resize: vertical;
  min-height: 100px;
}

.tender-form .form-actions {
  display: flex;
  gap: 15px;
  justify-content: flex-end;
  margin-top: 30px;
  padding-top: 25px;
  border-top: 1px solid #dee2e6;
}

.tender-form .btn {
  padding: 12px 30px;
  border-radius: 5px;
  font-weight: 500;
  text-decoration: none;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
}

.tender-form .btn-primary {
  background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
  color: white;
}

.tender-form .btn-primary:hover {
  background: linear-gradient(135deg, #1a3464 0%, #245089 100%);
  transform: translateY(-1px);
}

.tender-form .btn-secondary {
  background: #6c757d;
  color: white;
}

.tender-form .btn-secondary:hover {
  background: #5a6268;
}

/* Requirements Sidebar */
.requirements-card {
  background: white;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  overflow: hidden;
}

.requirements-card h4 {
  background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
  color: white;
  margin: 0;
  padding: 20px;
  font-size: 16px;
  font-weight: 600;
}

.requirement-list {
  padding: 20px;
}

.requirement-item {
  display: flex;
  align-items: flex-start;
  margin-bottom: 15px;
  font-size: 14px;
}

.requirement-item .check-icon {
  margin-right: 10px;
  font-size: 16px;
  flex-shrink: 0;
}

.requirement-item.completed .requirement-text {
  color: #28a745;
}

.requirement-status {
  background: #e8f5e8;
  padding: 20px;
  border-top: 1px solid #dee2e6;
}

.requirement-status .status-text {
  color: #28a745;
  font-weight: 600;
  margin: 0 0 10px 0;
}

.requirement-status .status-subtext {
  color: #666;
  margin: 0 0 15px 0;
  font-size: 14px;
}

.requirement-status .btn-info {
  background: #17a2b8;
  color: white;
  padding: 8px 15px;
  border-radius: 5px;
  border: none;
  font-size: 14px;
  cursor: pointer;
  transition: background 0.2s;
}

.requirement-status .btn-info:hover {
  background: #138496;
}

/* Responsive Design */
@media (max-width: 768px) {
  .tender-form-container {
    flex-direction: column;
  }
  
  .tender-requirements-sidebar {
    width: 100%;
  }
  
  .tender-form .form-row {
    flex-direction: column;
    gap: 0;
  }
  
  .tender-form .form-group.col-6 {
    flex: 1;
  }
  
  .tender-form .form-actions {
    flex-direction: column;
  }
}

/* Auto-calculation styling */
#total_budget {
  background-color: #f8f9fa;
  font-weight: bold;
}
</style>

<script>
// Add event listeners for auto-calculation
document.addEventListener('DOMContentLoaded', function() {
  // Auto-calculate total budget when inputs change
  document.addEventListener('input', function(e) {
    if (e.target.id === 'budget_per_episode' || e.target.id === 'total_episodes') {
      calculateTotalBudget();
    }
  });
});